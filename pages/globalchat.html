<div id="tornpa-chat-system">
    <div id="chat-bar-collapsed">
        <div id="open-faction-chat-icon" class="chat-bar-icon" title="Faction Chat">ü§ù</div>
        <div id="open-alliance-chat-icon" class="chat-bar-icon" title="Alliance Chat">ü§ù</div>
        <div id="open-war-chat-icon" class="chat-bar-icon" title="War Chat">‚öîÔ∏è</div>
        <div id="open-friends-icon" class="chat-bar-icon" title="Friends">üë•</div>
        <div id="open-graph-icon" class="chat-bar-icon" title="Faction Overview">üìä</div>
        <div id="open-notifications-icon" class="chat-bar-icon" title="Notifications">üîî</div>
        <div id="open-settings-icon" class="chat-bar-icon" title="Settings">‚öôÔ∏è</div>
    </div>

    <div id="chat-window" class="hidden">
        <div class="chat-main-tabs-container hidden">
            <div id="dynamic-tabs-container"></div>
            <div id="static-tabs-container">
            </div>
        </div>

        <div id="faction-chat-panel" class="chat-panel active">
            <div class="chat-header">
                <span class="chat-title">Faction Chat</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div id="chat-display-area" class="chat-display-area">
            </div>
            <div id="chat-input-area" class="chat-input-area">
                <input type="text" class="chat-text-input" placeholder="Type your message...">
                <button class="chat-send-btn">Send</button>
            </div>
        </div>

        <div id="alliance-chat-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">Alliance Chat</span>
                <button class="minimize-chat-btn">‚Äï</button>
            </div>
            <div class="chat-display-area" id="alliance-chat-display-area">
                <p>Loading alliance messages...</p>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-text-input" id="alliance-chat-text-input" placeholder="Type your message...">
                <button class="chat-send-btn" id="alliance-chat-send-btn">Send</button>
            </div>
        </div>

        <div id="war-chat-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">War Chat</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div id="war-chat-display-area" class="chat-messages-scroll-wrapper">
            </div>
            <div id="war-chat-input-area" class="chat-input-area">
                <input type="text" class="chat-text-input" placeholder="Type your message...">
                <button class="chat-send-btn">Send</button>
            </div>
        </div>

        <div id="friends-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">Friends</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div class="friends-panel-subtabs">
                <button class="sub-tab-button active" data-subtab="recent-chats" title="Recent Chats">‚úâÔ∏è</button>
                <button class="sub-tab-button" data-subtab="recently-met" title="Recently Met">üëã</button>
                <button class="sub-tab-button" data-subtab="faction-members" title="Faction Members">üè∞</button>
                <button class="sub-tab-button" data-subtab="friend-list" title="Friend List">üë§</button>
                <button class="sub-tab-button" data-subtab="ignore-list" title="Ignore List">üö´</button>
            </div>
            <div class="friends-panel-search">
                <input type="text" class="search-input" placeholder="Search by player name...">
                <span class="search-icon">üîç</span>
            </div>
            <div class="friends-panel-content">
                <p style="text-align: center; color: #888; padding-top: 20px;">Content will be loaded here.</p>
            </div>
        </div>

        <div id="notifications-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">Notifications</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div class="notifications-content-wrapper">
                <div class="notification-section site-notifications">
                    <h4>Site Notifications üåê</h4>
                    <div class="notification-list" id="site-notification-list">
                        <p>No new site notifications.</p>
                    </div>
                </div>
                <div class="notification-section friend-notifications">
                    <h4>Friend Notifications üë•</h4>
                    <div class="notification-list" id="friend-notification-list">
                        <p>No new friend notifications.</p>
                    </div>
                </div>
                <div class="notification-section general-notifications">
                    <h4>Other Notifications üîî</h4>
                    <div class="notification-list" id="general-notification-list">
                        <p>No other notifications.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">Settings</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div class="settings-content-wrapper">
                <div class="settings-section">
                    <h4>General Actions ‚öôÔ∏è</h4>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="markAllChatsRead">
                            <span class="slider round"></span>
                        </label>
                        <label for="markAllChatsRead">Mark All Chats as Read</label>
                    </div>
                    <div class="setting-item">
                        <button class="action-button" id="closeAllPrivateChats">Close All Private Chats</button>
                    </div>
                    <div class="setting-item">
                        <button class="action-button" id="deleteAllPrivateMessages">Delete All Private Messages</button>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Alliance Chat Settings ü§ù</h4>
                    <div class="setting-item">
                        <label for="allianceFactionId">Enter Faction ID:</label>
                        <input type="text" id="allianceFactionId" placeholder="e.g., 49028">
                    </div>
                    <div class="setting-item">
                        <button class="action-button secondary" id="saveAlliance">Save</button>
                        <button class="action-button danger" id="clearAlliances">Clear All Alliances</button>
                        <span class="info-icon" id="allianceInfoIcon" title="Your current saved alliances will appear here on hover.">‚ÑπÔ∏è</span>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Global Chat Toggles üåç</h4>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleWarChat">
                            <span class="slider round"></span>
                        </label>
                        <label for="toggleWarChat">Toggle War Chat (On/Off)</label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="profanityFilter">
                            <span class="slider round"></span>
                        </label>
                        <label for="profanityFilter">Profanity Filter (On/Off)</label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="muteSiteSounds">
                            <span class="slider round"></span>
                        </label>
                        <label for="muteSiteSounds">Mute Site Sounds</label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="muteWarSounds">
                            <span class="slider round"></span>
                        </label>
                        <label for="muteWarSounds">Mute War Sounds</label>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>User Status & Display üßç</h4>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="appearOnlineOffline">
                            <span class="slider round"></span>
                        </label>
                        <label for="appearOnlineOffline">Appear Online/Offline</label>
                    </div>
                    <div class="setting-group">
                        <p>User Status Display:</p>
                        <div class="radio-group">
                            <input type="radio" id="statusOnlineOffline" name="userStatusDisplay" value="onlineOffline">
                            <label for="statusOnlineOffline">Online/Offline</label>
                            <input type="radio" id="statusLastAction" name="userStatusDisplay" value="lastAction">
                            <label for="statusLastAction">Last Action</label>
                            <input type="radio" id="statusNone" name="userStatusDisplay" value="none" checked>
                            <label for="statusNone">None</label>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>General Chat Display üí¨</h4>
                    <div class="setting-group">
                        <p>Font Size:</p>
                        <div class="radio-group">
                            <input type="radio" id="fontSizeSmall" name="fontSize" value="small">
                            <label for="fontSizeSmall">Small</label>
                            <input type="radio" id="fontSizeMedium" name="fontSize" value="medium" checked>
                            <label for="fontSizeMedium">Medium</label>
                            <input type="radio" id="fontSizeLarge" name="fontSize" value="large">
                            <label for="fontSizeLarge">Large</label>
                        </div>
                    </div>
                    <div class="setting-group">
                        <p>Chat Theme:</p>
                        <div class="radio-group">
                            <input type="radio" id="themeDark" name="chatTheme" value="dark" checked>
                            <label for="themeDark">Dark</label>
                            <input type="radio" id="themeLight" name="chatTheme" value="light" disabled>
                            <label for="themeLight">Light (Coming Soon)</label>
                        </div>
                    </div>
                    <div class="setting-group">
                        <p>Message Density:</p>
                        <div class="radio-group">
                            <input type="radio" id="densityCompact" name="messageDensity" value="compact">
                            <label for="densityCompact">Compact</label>
                            <input type="radio" id="densityNormal" name="messageDensity" value="normal" checked>
                            <label for="densityNormal">Normal</label>
                            <input type="radio" id="densitySpacious" name="messageDensity" value="spacious">
                            <label for="densitySpacious">Spacious</label>
                        </div>
                    </div>
                    <div class="setting-group">
                        <p>Chat Input Size:</p>
                        <div class="radio-group">
                            <input type="radio" id="inputSizeSmall" name="inputSize" value="small">
                            <label for="inputSizeSmall">Small</label>
                            <input type="radio" id="inputSizeMedium" name="inputSize" value="medium" checked>
                            <label for="inputSizeMedium">Medium</label>
                            <input type="radio" id="inputSizeLarge" name="inputSize" value="large">
                            <label for="inputSizeLarge">Large</label>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="showTimestamps" checked>
                            <span class="slider round"></span>
                        </label>
                        <label for="showTimestamps">Show Timestamps in Chat</label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoScrollChat" checked>
                            <span class="slider round"></span>
                        </label>
                        <label for="autoScrollChat">Auto-Scroll Chat</label>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" id="profanityFilterLocal" checked>
                            <span class="slider round"></span>
                        </label>
                        <label for="profanityFilterLocal">Profanity Filter (Local)</label>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Notification Method üîî</h4>
                    <div class="setting-group">
                        <p>Notification Method:</p>
                        <div class="radio-group">
                            <input type="radio" id="notifyBrowser" name="notificationMethod" value="browser">
                            <label for="notifyBrowser">Browser Pop-up</label>
                            <input type="radio" id="notifySoundOnly" name="notificationMethod" value="soundOnly" checked>
                            <label for="notifySoundOnly">Sound Only</label>
                            <input type="radio" id="notifyNone" name="notificationMethod" value="none">
                            <label for="notifyNone">None</label>
                        </div>
                        <p class="setting-note">(Note: Browser pop-ups are an advanced feature requiring user permission.)</p>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>Data & Actions üíæ</h4>
                    <div class="setting-item">
                        <button class="action-button primary" id="saveAllSettings">Save All Settings</button>
                    </div>
                    <div class="setting-item">
                        <button class="action-button danger" id="clearChatHistoryLocal">Clear Chat History (Local)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="faction-overview-panel" class="chat-panel hidden">
            <div class="chat-header">
                <span class="chat-title">Faction Overview</span>
                <button class="minimize-chat-btn">-</button>
            </div>
            <div id="faction-overview-content" class="chat-display-area">
                <p style="text-align: center; color: #888; padding-top: 20px;">Loading Faction Overview...</p>
            </div>
        </div>
        </div>
</div>